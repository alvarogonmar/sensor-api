<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Sensores</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="container">
        <h1>Dashboard de Sensores</h1>

        <!-- Dropdown -->
        <form method="get" action="/dashboard">
            <label>Seleccionar sensor:</label>
                <select name="device">
                    <option value="all" {% if selected_id == "all" %}selected{% endif %}>Todos</option>
                
                    {% for dev in device_ids %}
                    <option value="{{ dev }}" {% if selected_id == dev|string %}selected{% endif %}>
                        Sensor {{ dev }}
                    </option>
                    {% endfor %}
                </select>
            <button type="submit">Mostrar</button>
        </form>

        <hr>
        {% if selected_id == "all" %}
            <h2>Todos los Sensores â€” Ãšltimas 100 Lecturas</h2>
        
            <table>
                <thead>
                    <tr>
                        <th>Sensor ID</th>
                        <th>Timestamp</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sid, value, created_at in rows %}
                    <tr>
                        <td>{{ sid }}</td>
                        <td>{{ created_at }}</td>
                        <td>{{ value }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        
            <h2>ðŸ“ˆ Graph</h2>
            <canvas id="sensorChart"></canvas>
        
{% else %}

    {% if selected_id %}
        
        <h2>InformaciÃ³n del Dispositivo</h2>

        <p><strong>Nombre:</strong> Sensor {{ selected_id }}</p>
        <p><strong>ID:</strong> {{ selected_id }}</p>
        <p><strong>Ãšltima actualizaciÃ³n:</strong> {{ last_update }}</p>

        <h2>Sensor {{ selected_id }} â€” Ãšltimas 10 Lecturas</h2>

        <h2>ðŸ“‹ Data Table</h2>
        <table>
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody>
                {% for value, created_at in rows %}
                <tr>
                    <td>{{ created_at }}</td>
                    <td>{{ value }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>ðŸ“ˆ Graph</h2>
        <canvas id="sensorChart"></canvas>

    {% else %}
        <p>Selecciona un sensor para mostrar datos.</p>
    {% endif %}

{% endif %}
        
{% if values and timestamps %}
<script>
    const ctx = document.getElementById('sensorChart');

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ timestamps|tojson }},
            datasets: [{
                label: 'Sensor Value',
                data: {{ values|tojson }},
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            scales: {
                x: { title: { display: true, text: 'Time' }},
                y: { title: { display: true, text: 'Value' }}
            }
        }
    });
</script>
{% endif %}



</body>
</html>
